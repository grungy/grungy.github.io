<!DOCTYPE html>
<html lang="en">
  <head>
  	<meta charset="utf-8">
  	<meta name="viewport"    content="width=device-width, initial-scale=1.0">
  	<meta name="description" content="">
  	<meta name="author"      content="map[]">
    
    	<title>Posts</title>
	<link rel="shortcut icon" href="https://joshmarks.xyz/images/favicon.png">

	
	<link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.no-icons.min.css" rel="stylesheet">
	
	
	<script defer src="https://use.fontawesome.com/releases/v5.0.11/js/all.js" integrity="sha384-ImVoB8Er8knetgQakxuBS4G3RSkyD8IZVVQCAnmRJrDwqJFYUE4YOv+DbIofcO9C" crossorigin="anonymous"></script>
	
	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alice|Open+Sans:400,300,700">
	
	
  
  <link rel="stylesheet" href="https://joshmarks.xyz/css/styles.min.64a6643395c6bf1ec6fff31d6429046b3ad467e58a279ff252dc019edd80a87051cf90b7fe2d589277def72d84602dcbc7115e2e17a94db3a8838336986a0ae3.css" integrity="sha512-ZKZkM5XGvx7G//MdZCkEazrUZ&#43;WKJ5/yUtwBnt2AqHBRz5C3/i1Yknfe9y2EYC3LxxFeLhepTbOog4M2mGoK4w==">

   
  

  </head>
  
  <body class="home">

    
      <header id="header">
  <div id="head" class="parallax" data-parallax-speed="2" style="background-image:url('https://joshmarks.xyz/images/Mountains-wiki.png');">
    <h1 id="logo" class="text-center">
      <img class='img-circle' src="https://joshmarks.xyz/images/bio-photo.jpeg" alt="">
      <span class="title">Josh Marks</span>
      <span class="tagline">An Eccentric Engineer<br>
        <a href="mailto:marksua@gmail.com">marksua@gmail.com</a>
      </span>
   </h1>
</div>

<nav class="navbar navbar-default navbar-sticky">
    <div class="container-fluid">

        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="true">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <div class="navbar-collapse collapse" id="bs-example-navbar-collapse-1">

            <ul class="nav navbar-nav">
            
                
                <li>
                    <a href="/">home</a>
                </li>
                
            
                
                <li>
                    <a href="/post/">blog</a>
                </li>
                
            
            </ul>

        </div> 
        
    </div>
</nav>

</header>
    
 
    
<main id="main">

	<div class="container">
		<div class="row topspace">
			<div class="col-sm-8 col-sm-offset-2">

        
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
               <span class="posted-on">
                  <time class="entry-date published" datetime="May 27, 2021">May 27, 2021</time>
               </span>
						</div>
						<h1 class="entry-title">
						  <a href="https://joshmarks.xyz/post/test-post/" rel="bookmark">Test Post</a>
						</h1>
					</header>
					<div class="entry-content">
						<p>test test</p>

					</div>
				</article>
        
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
               <span class="posted-on">
                  <time class="entry-date published" datetime="May 27, 2021">May 27, 2021</time>
               </span>
						</div>
						<h1 class="entry-title">
						  <a href="https://joshmarks.xyz/post/current-feedback/" rel="bookmark">Current Feedback</a>
						</h1>
					</header>
					<div class="entry-content">
						<p><strong>Big takeaway:</strong> Current feedback opamps are very particular about external component values. You must choose from the list of approved values in the datasheet or spend a lot of time hunting for an optimum value that gives you the gain and also provides stability.</p>
<p><strong>Summary:</strong> I replaced the feedback resistor elements with 510 ohm resistors for Rf and Rg. This gives a gain of two and the widest bandwidth, 1.4GHz, from the OPA695. Opamps behave much better. No more 416MHz ringing. I also removed the feedback capacitor because I read that this causes instability in the op amp.</p>
<p><strong>Initial results:</strong></p>
<p><img src="/hugo-initio-site/images/21_1_board.png" alt="21 to 1"></p>
<p>The 21:1 divider is constructed with R31 and R32. The resistor divider formed by these two resistors minimizes the effect the cable and oscilloscope parasitics on the amplifier circuit. This gives a more realistic view of the behavior of the circuit. The following two figures show the value of the 21:1 divider. With the 21:1 divider it can be seen that the behavior of the two circuits is the same. The difference seen before was due to the effect of the cable and oscilloscope loading the circuit. <strong>What this meant was the circuit design was very sensitive to parasitic loading.</strong></p>
<p><img src="/hugo-initio-site/images/cf/trace1.png" alt="21 to 1">
<img src="/hugo-initio-site/images/cf/trace2.png" alt="21 to 1"></p>
<h2 id="circuit-update">Circuit Update</h2>
<p>I learned from this document, <a href="http://www.ti.com/lit/an/sloa021a/sloa021a.pdf,">http://www.ti.com/lit/an/sloa021a/sloa021a.pdf,</a> that current feedback op amps (CFAs) are very particular about the values of the external components. The IC designers spend a lot of time looking for good values of external resistors. It is not as easy as a voltage feedback op amp. The recommended values are shown below in the table. I ended up choosing a gain of two because the OPA695 will have the widest bandwidth at this gain value, 1.4GHz.  To get a gain of 2 511 ohm resistors are used for the two feedback resistors. I put 510 ohm resistors on the test board because that was the closest part available in the lab. I also read that having a capacitor in the feedback loop of a CFA is very bad for stability so I removed the capacitor.</p>
<p>Both of these changes drastically improved the response of the amplifier.</p>
<p>The resistors Rf and Rg are the 511 ohm resistors in this schematic.</p>
<p><img src="/hugo-initio-site/images/cf/opa6952gain.png" alt="OPA695 Gain"></p>
<p><img src="/hugo-initio-site/images/cf/opa695_resistor_values.png" alt="opa695_resistor_values"></p>
<p><img src="/hugo-initio-site/images/cf/trace3.png" alt="trace3"></p>
<p><img src="/hugo-initio-site/images/cf/trace4.png" alt="trace4"></p>
<p><img src="/hugo-initio-site/images/cf/trace5.png" alt="trace5"></p>
<p><img src="/hugo-initio-site/images/cf/trace6.png" alt="trace6"></p>
<h2 id="straight-post-amp-testing">Straight Post-amp Testing:</h2>
<p>After seeing an improvement in the response of the 21:1 divider board I wanted to see what the improvement was for the straight post-amp test board.</p>
<p><img src="/hugo-initio-site/images/cf/post-amp-board.png" alt="post-amplifier"></p>
<p>After modifying the circuit to also have a gain of 2 like I did for the 21:1 divider the response is greatly improved.</p>
<p><img src="/hugo-initio-site/images/cf/trace7.png" alt="trace7"></p>
<p><img src="/hugo-initio-site/images/cf/trace8.png" alt="trace8"></p>
<p><img src="/hugo-initio-site/images/cf/trace9.png" alt="trace9"></p>
<h2 id="bit-resolution">Bit Resolution:</h2>
<p>A crude measurement of bit resolution can be done by measuring the rough noise level. This measurement is shown in the following image and is ~30mV.</p>
<p>To get the amount of bits lost first the LSB must be calculated:</p>
<p>Max voltage / 2^num_bits = voltage/bit</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Max Voltage</th>
<th>Volts / LSB</th>
</tr>
</thead>
<tbody>
<tr>
<td>16</td>
<td>5</td>
<td>7.62939E-05</td>
</tr>
</tbody>
</table>
<p>Using our measured noise margin of 42mV the number of lost numbers can be calculated. 0.042/7.62939*10^-5 = 550. Taking the log base 2 of 550 gives us the number of bits lost: 9.104605043. And subtracting this value from 16 bits gives us the remaining bits we have: 6.895394957. So 6 or 7 bits. I also measured the signal generator directly and it had the same amount of noise. So, the noise level seems to be inherent in the scope or signal generator.</p>
<p><img src="/hugo-initio-site/images/cf/trace10.png" alt="trace10"></p>
<h2 id="5v-operation">5V operation</h2>
<p>5V operation was accomplished with the power supplies set to +-6.5. The scope shows 2.5 volts because of the resistor divider on the output of the post amp.</p>
<p><img src="/hugo-initio-site/images/cf/trace11.png" alt="trace11"></p>

					</div>
				</article>
        
			</div>
		</div>

		<center class="">
			<ul class="pagination">
        


			</ul>
		</center>
	</div>	

</main>

    
    
      <footer id="footer">
	<div class="container">
		<div class="row">
			

			

			

			

		</div> 
	</div>
</footer>

<footer id="underfooter">
	<div class="container">
		<div class="row">

			<div class="col-md-6 widget">
				<div class="widget-body">
					<p></p>
				</div>
			</div>

			<div class="col-md-6 widget">
				<div class="widget-body">
					<p class="text-right">
						Copyright &copy; 2021, Josh Marks<br>
						Design: <a href="http://www.gettemplate.com" rel="designer">Initio by GetTemplate</a> - 
						Powered by: <a href="https://gohugo.io/" rel="poweredby">Hugo</a>
					</p>
				</div>
			</div>

		</div> 
	</div>
</footer>




<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>




<script src="https://joshmarks.xyz/js/bundle.min.f4a965ad0a8118e32f8f0f158ff3aadbacf700934c22286a1a5b245105e9006da73a873b001a160db22498909c1df14d1f835dba5ad76f80b32b0234182b2a58.js" integrity="sha512-9KllrQqBGOMvjw8Vj/Oq26z3AJNMIihqGlskUQXpAG2nOoc7ABoWDbIkmJCcHfFNH4NdulrXb4CzKwI0GCsqWA=="></script>

<script id="dsq-count-scr" src="//hugo-initio-site.disqus.com/count.js" async></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'GA-000000000-0', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>

    
  </body>
  
</html>