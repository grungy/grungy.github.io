<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Josh Marks&#39; Blog!</title>
    
    <meta name="description" content="Around - Multipurpose Bootstrap Template">
    <meta name="keywords" content="bootstrap, business, consulting, coworking space, services, creative agency, dashboard, e-commerce, mobile app showcase, multipurpose, product landing, shop, software, ui kit, web studio, landing, html5, css3, javascript, gallery, slider, touch, creative">
    <meta name="author" content="Createx Studio">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="mask-icon" color="#5bbad5" href="safari-pinned-tab.svg">
    <meta name="msapplication-TileColor" content="#766df4">
    <meta name="theme-color" content="#ffffff">
    
    <style>
      .page-loading {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 100%;
        -webkit-transition: all .4s .2s ease-in-out;
        transition: all .4s .2s ease-in-out;
        background-color: #fff;
        opacity: 0;
        visibility: hidden;
        z-index: 9999;
      }
      .page-loading.active {
        opacity: 1;
        visibility: visible;
      }
      .page-loading-inner {
        position: absolute;
        top: 50%;
        left: 0;
        width: 100%;
        text-align: center;
        -webkit-transform: translateY(-50%);
        transform: translateY(-50%);
        -webkit-transition: opacity .2s ease-in-out;
        transition: opacity .2s ease-in-out;
        opacity: 0;
      }
      .page-loading.active > .page-loading-inner {
        opacity: 1;
      }
      .page-loading-inner > span {
        display: block;
        font-family: 'Inter', sans-serif;
        font-size: 1rem;
        font-weight: normal;
        color: #737491;
      }
      .page-spinner {
        display: inline-block;
        width: 2.75rem;
        height: 2.75rem;
        margin-bottom: .75rem;
        vertical-align: text-bottom;
        border: .15em solid #766df4;
        border-right-color: transparent;
        border-radius: 50%;
        -webkit-animation: spinner .75s linear infinite;
        animation: spinner .75s linear infinite;
      }
      @-webkit-keyframes spinner {
        100% {
          -webkit-transform: rotate(360deg);
          transform: rotate(360deg);
        }
      }
      @keyframes spinner {
        100% {
          -webkit-transform: rotate(360deg);
          transform: rotate(360deg);
        }
      }
      
    </style>
    
    <script>
      (function () {
        window.onload = function () {
          var preloader = document.querySelector('.page-loading');
          preloader.classList.remove('active');
          setTimeout(function () {
            preloader.remove();
          }, 2000);
        };
      })();
      
    </script>
    
    <link rel="stylesheet" media="screen" href="/vendor/simplebar/dist/simplebar.min.css"/>
    <link rel="stylesheet" media="screen" href="/vendor/tiny-slider/dist/tiny-slider.css"/>
    <link rel="stylesheet" media="screen" href="/vendor/lightgallery.js/dist/css/lightgallery.min.css" />
    
    <link rel="stylesheet" media="screen" href="/css/theme.min.css">
  </head><body>
<div class="page-loading active">
  <div class="page-loading-inner">
    <div class="page-spinner"></div><span>Loading...</span>
  </div>
</div>
<main class="page-wrapper">
  
  <div class="modal fade" id="modal-contact" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header mb-1">
          <h4 class="modal-title">What project are you looking for?</h4>
          <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form class="modal-body needs-validation py-4" novalidate>
          <div class="btn-group mb-3">
            <div class="me-2 mb-2">
              <input class="btn-check" type="radio" name="services" id="illustration" autocomplete="off" checked>
              <label class="btn btn-outline-primary" for="illustration">Prototyping</label>
            </div>
            <div class="me-2 mb-2"> 
              <input class="btn-check" type="radio" name="services" id="packaging" autocomplete="off">
              <label class="btn btn-outline-primary" for="packaging">Firmware</label>
            </div>
            <div class="me-2 mb-2">
              <input class="btn-check" type="radio" name="services" id="branding" autocomplete="off">
              <label class="btn btn-outline-primary" for="branding">EMC</label>
            </div>
          </div>
          <div class="input-group mb-3"><i class="ai-user position-absolute top-50 start-0 translate-middle-y ms-3"></i>
            <input class="form-control rounded" type="text" placeholder="Name" required>
          </div>
          <div class="input-group mb-3"><i class="ai-mail position-absolute top-50 start-0 translate-middle-y ms-3"></i>
            <input class="form-control rounded" type="email" placeholder="Email" required>
          </div>
          <div class="mb-3 pb-1">
            <textarea class="form-control" rows="4" placeholder="Project description" required></textarea>
          </div>
          <div class="row py-2">
            <div class="col-lg-6 col-md-8">
              <button class="btn btn-primary d-block w-100" type="submit">Send Request</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

      
      <header class="header navbar navbar-expand-lg navbar-light bg-light navbar-shadow navbar-sticky" data-scroll-header data-fixed-element>
        <div class="navbar-search bg-light">
            <div class="container d-flex flex-nowrap align-items-center"><i class="ai-search fs-xl"></i>
              <input class="form-control form-control-xl navbar-search-field" type="text" placeholder="Search site">
              <div class="d-flex align-items-center"><span class="text-muted fs-xs mt-1 d-none d-sm-inline">Close</span>
                <button class="btn-close p-2" type="button" data-bs-toggle="search"></button>
              </div>
            </div>
          </div>
          <div class="container px-0 px-xl-3">
            <button class="navbar-toggler ms-n2 me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#primaryMenu"><span class="navbar-toggler-icon"></span></button><a class="navbar-brand flex-shrink-0 order-lg-1 mx-auto ms-lg-0 pe-lg-2 me-lg-4" href="/index.html"><img class="d-none d-lg-block" src="/img/jam/logo-dark.png" alt="Around" width="100"><img class="d-lg-none" src="/img/jam/jam-logo.png" alt="Around" width="58"></a>
            <div class="d-flex align-items-center order-lg-3 ms-lg-auto"><a class="btn btn-primary d-lg-inline-block d-none" href="#modal-contact" data-bs-toggle="modal">Contact me</a><a class="btn btn-sm btn-primary d-lg-none d-inline-block" href="#modal-contact" data-bs-toggle="modal">Contact me</a></div>
            <div class="offcanvas offcanvas-collapse order-lg-2" id="primaryMenu">
              <div class="offcanvas-header navbar-shadow">
                <h5 class="mt-1 mb-0">Menu</h5>
                <button class="btn-close lead" type="button" data-bs-dismiss="offcanvas" aria-label="Close"></button>
              </div>
              <div class="offcanvas-body">
              
              <ul class="navbar-nav">
                
                <a class="nav-link" href="/posts/">
                    
                    Blog
                </a>
                
                <a class="nav-link" href="/projects/">
                    
                    Projects
                </a>
                
                <a class="nav-link" href="/books/">
                    
                    Books
                </a>
                
                <a class="nav-link" href="/about/">
                    
                    About Me
                </a>
                
              </ul>
            </div>
            
          
        </div>
      </header><div id="content">
<div class="container">
    
    
    <div class="row justify-content-center">
      
      <div class="col-lg-9 py-4 mb-2 mb-sm-0 pb-sm-5">
        <div class="pb-4" style="max-width: 38rem;">
            <nav aria-label="breadcrumb">
    <ol class="py-1 my-2 breadcrumb">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        
            
        
            
                <li class="breadcrumb-item"><a href="/posts">Blog</a></li>
            
        
            
                <li class="breadcrumb-item"><a href="/current-feedback-opamp-testing">Current feedback opamp testing</a></li>
            
        
            
        
    </ol>
</nav>
          <h1>Current Feedback Op-amp Testing</h1>
        </div>
        


<time datetime="2021-07-25">Jul 25, 2021</time>
        
        <p class="py-3"><p><strong>Big takeaway:</strong> Current feedback opamps are very particular about external component values. You must choose from the list of approved values in the datasheet or spend a lot of time hunting for an optimum value that gives you the gain and also provides stability.</p>
<p><strong>Summary:</strong> I replaced the feedback resistor elements with 510 ohm resistors for Rf and Rg. This gives a gain of two and the widest bandwidth, 1.4GHz, from the OPA695. Opamps behave much better. No more 416MHz ringing. I also removed the feedback capacitor because I read that this causes instability in the op amp.</p>
<h2 id="211-board-testing">21:1 Board Testing:</h2>
<p><strong>Initial results:</strong>
<figure class="figure">
    <img src="/images/current-feedback-testing/21_1_board.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption">Figure 1: Post-amp circuit with 21:1 divider circuit. Resistors R32 and R31 form the 21:1 divider.</figcaption>
</figure></p>
<p>The 21:1 divider is constructed with R31 and R32. The resistor divider formed by these two resistors minimizes the effect the cable and oscilloscope parasitics on the amplifier circuit. This gives a more realistic view of the behavior of the circuit. The following two figures show the value of the 21:1 divider. With the 21:1 divider it can be seen that the behavior of the two circuits is the same. The difference seen before was due to the effect of the cable and oscilloscope loading the circuit. <strong>What this meant was the circuit design was very sensitive to parasitic loading.</strong></p>
<figure class="figure">
    <img src="/images/current-feedback-testing/trace1.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<figure class="figure">
    <img src="/images/current-feedback-testing/trace2.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<h2 id="circuit-update">Circuit Update:</h2>
<p>I learned from this document, <a href="http://www.ti.com/lit/an/sloa021a/sloa021a.pdf,">http://www.ti.com/lit/an/sloa021a/sloa021a.pdf,</a> that current feedback op amps (CFAs) are very particular about the values of the external components. The IC designers spend a lot of time looking for good values of external resistors. It is not as easy as a voltage feedback op amp. The recommended values are shown below in the table. I ended up choosing a gain of two because the OPA695 will have the widest bandwidth at this gain value, 1.4GHz.  To get a gain of 2 511 ohm resistors are used for the two feedback resistors. I put 510 ohm resistors on the test board because that was the closest part available in the lab. I also read that having a capacitor in the feedback loop of a CFA is very bad for stability so I removed the capacitor.</p>
<p>Both of these changes drastically improved the response of the amplifier.</p>
<p>The resistors Rf and Rg are the 511 ohm resistors in this schematic.</p>
<figure class="figure">
    <img src="/images/current-feedback-testing/opa6952gain.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<figure class="figure">
    <img src="/images/current-feedback-testing/opa695_resistor_values.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<figure class="figure">
    <img src="/images/current-feedback-testing/trace3.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<figure class="figure">
    <img src="/images/current-feedback-testing/trace4.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<figure class="figure">
    <img src="/images/current-feedback-testing/trace5.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<figure class="figure">
    <img src="/images/current-feedback-testing/trace6.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<h2 id="straight-post-amp-testing">Straight Post-amp Testing:</h2>
<p>After seeing an improvement in the response of the 21:1 divider board I wanted to see what the improvement was for the straight post-amp test board.</p>
<figure class="figure">
    <img src="/images/current-feedback-testing/post-amp-board.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<p>After modifying the circuit to also have a gain of 2 like I did for the 21:1 divider the response is greatly improved.</p>
<figure class="figure">
    <img src="/images/current-feedback-testing/trace7.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<figure class="figure">
    <img src="/images/current-feedback-testing/trace8.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<figure class="figure">
    <img src="/images/current-feedback-testing/trace9.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<h2 id="bit-resolution">Bit Resolution:</h2>
<p>A crude measurement of bit resolution can be done by measuring the rough noise level. This measurement is shown in the following image and is ~30mV.</p>
<p>To get the amount of bits lost first the LSB must be calculated:</p>
<p>$$\frac{Max voltage}{2^{Num Bits}} = \frac{voltage}{bit}$$</p>

<div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          <th>Bits</th>
          <th>Max Voltage</th>
          <th>Volt / LSB</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row">1</th>
          <td>16</td>
          <td>5</td>
          <td>7.62939E-05</td>
        </tr>
      </tbody>
    </table>
  </div>
<p>Using our measured noise margin of 42mV the number of lost numbers can be calculated. \(\frac{0.042}{7.62939*10^{-5}} = 550\). Taking the log base 2 of 550 gives us the number of bits lost: 9.104605043. And subtracting this value from 16 bits gives us the remaining bits we have: 6.895394957. So 6 or 7 bits. I also measured the signal generator directly and it had the same amount of noise. So, the noise level seems to be inherent in the scope or signal generator.</p>
<figure class="figure">
    <img src="/images/current-feedback-testing/trace10.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
<h2 id="5v-operation">5V operation:</h2>
<p>5V operation was accomplished with the power supplies set to +-6.5. The scope shows 2.5 volts because of the resistor divider on the output of the post amp.</p>
<figure class="figure">
    <img src="/images/current-feedback-testing/trace11.png" class="figure-img" alt="..." style="max-width: 600px;">
    <figcaption class="figure-caption"></figcaption>
</figure>
</p>


        </div><footer class="footer pb-4 mt-sm-n5">
    <div class="container fs-sm text-center"><span class="text-muted">Â© 2021 All rights reserved. Made by Josh Marks</span></div>
</footer><a class="btn-scroll-top" href="#top" data-scroll data-fixed-element><span class="btn-scroll-top-tooltip text-muted fs-sm me-2">Top</span><i class="btn-scroll-top-icon ai-arrow-up">   </i></a>
    
    <script src="/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/vendor/simplebar/dist/simplebar.min.js"></script>
    <script src="/vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
    <script src="/vendor/tiny-slider/dist/min/tiny-slider.js"></script>
    <script src="/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="/vendor/shufflejs/dist/shuffle.min.js"></script>
    <script src="/vendor/parallax-js/dist/parallax.min.js"></script>
    <script src="/vendor/lightgallery.js/dist/js/lightgallery.min.js"></script>
    <script src="/vendor/lg-fullscreen.js/dist/lg-fullscreen.min.js"></script>
    <script src="/vendor/lg-zoom.js/dist/lg-zoom.min.js"></script>
    <script src="/vendor/lg-video.js/dist/lg-video.min.js"></script>
    <script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
    
    <script src="/js/theme.min.js"></script></body>
</html>
